{"id":"kb-setup-env-001","intent":"setup-local-env","question":"Come imposto l'ambiente locale (.env.local)?","tags":["env","local","powershell"],"preconditions":["PowerShell 7+","repo clonato"],"steps":["pwsh scripts/setup-env.ps1 -TenantId <TENANT> -AuthClientId <CLIENT_ID> -DbConnString '<CONN>' -DefaultBusinessTenant tenant01"],"verify":["File .env.local creato","Checklist OK"],"rollback":["Eliminare .env.local o rigenerare"],"outputs":["EasyWay-DataPortal/easyway-portal-api/.env.local"],"references":["EasyWay-DataPortal/easyway-portal-api/README.md","scripts/setup-env.ps1"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-checklist-002","intent":"predeploy-checklist","question":"Come eseguo il Checklist Bot?","tags":["checklist","quality"],"steps":["pwsh scripts/checklist.ps1"],"verify":["summary.ok=true"],"outputs":["checklist.json (artifact)"],"references":["EasyWay-DataPortal/easyway-portal-api/src/tools/checklist.ts","azure-pipelines.yml"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-start-api-003","intent":"start-api","question":"Come avvio l'API in sviluppo?","tags":["api","dev"],"steps":["cd EasyWay-DataPortal/easyway-portal-api","npm ci","npm run dev"],"verify":["http://localhost:3000/portal risponde"],"references":["EasyWay-DataPortal/easyway-portal-api/README.md"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-flyway-migrate-004","intent":"db-migrate","question":"Come eseguo le migrazioni Flyway?","tags":["db","flyway"],"preconditions":["FLYWAY_URL","FLYWAY_USER","FLYWAY_PASSWORD"],"steps":["flyway -configFiles=db/flyway/flyway.conf validate","flyway -configFiles=db/flyway/flyway.conf migrate"],"verify":["Tabella flyway_schema_history aggiornata"],"references":["db/flyway/README.md"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-terraform-plan-005","intent":"infra-plan","question":"Come eseguo Terraform plan/apply?","tags":["infra","terraform"],"preconditions":["RESOURCE_GROUP_NAME","STORAGE_ACCOUNT_NAME","TENANTS"],"steps":["cd infra/terraform","terraform init","terraform plan -var 'project_name=easyway' -var 'resource_group_name=${env:RESOURCE_GROUP_NAME}' -var 'storage_account_name=${env:STORAGE_ACCOUNT_NAME}' -var 'tenants=${env:TENANTS}'"],"verify":["Nessun errore nel plan"],"references":["infra/terraform/README.md","azure-pipelines.yml"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-ado-vg-006","intent":"ado-variable-group","question":"Come creo/aggiorno il Variable Group in ADO?","tags":["ado","variables"],"steps":["pwsh scripts/ado-set-variable-group.ps1 -OrgUrl <ORG> -Project <PROJ> -Pat <PAT> -GroupName EasyWay-Secrets -VariablesJsonPath scripts/variables/easyway-secrets.sample.json -SecretsKeys 'AZURE_STORAGE_CONNECTION_STRING,DB_CONN_STRING'"],"verify":["Variable Group aggiornato"],"references":["scripts/ado-set-variable-group.ps1","scripts/variables/easyway-secrets.sample.json"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-db-docs-007","intent":"db-generate-docs","question":"Come genero ERD e catalogo SP?","tags":["db","docs"],"steps":["cd EasyWay-DataPortal/easyway-portal-api","npm run db:generate-docs"],"verify":["Wiki/EasyWayData.wiki/.../ERD.md aggiornato"],"references":["EasyWay-DataPortal/easyway-portal-api/src/tools/db/generate-docs.ts"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-db-drift-008","intent":"db-drift-check","question":"Come verifico mancanze di oggetti DB?","tags":["db","quality"],"steps":["cd EasyWay-DataPortal/easyway-portal-api","npm run db:drift"],"verify":["report.ok=true"],"references":["EasyWay-DataPortal/easyway-portal-api/src/tools/db/drift-check.ts","scripts/variables/db-required-objects.sample.json"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-branding-009","intent":"branding-upload","question":"Come carico il branding yaml in dev?","tags":["storage","branding"],"steps":["Creare container 'portal-assets'","Caricare 'config/branding.tenant01.yaml' (vedi datalake-sample) in Blob/Azurite"],"verify":["/portal/tenant/tenant01 usa colori/logo"],"references":["EasyWay-DataPortal/easyway-portal-api/datalake-sample/branding.tenant01.yaml","EasyWay-DataPortal/easyway-portal-api/src/config/brandingLoader.ts"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-portal-demo-010","intent":"portal-login-register","question":"Come provo login & registrazione dalla demo?","tags":["portal","auth"],"steps":["Impostare AUTH_CLIENT_ID e AUTH_TENANT_ID in .env.local","Aprire http://localhost:3000/portal/app","Login con Microsoft e registrare utente"],"verify":["/api/onboarding 201","/api/users elenca l'utente"],"references":["EasyWay-DataPortal/easyway-portal-api/src/routes/portal.ts"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-enable-rls-011","intent":"db-enable-rls","question":"Come abilito la Row-Level Security (RLS) su USERS?","tags":["db","rls"],"preconditions":["Connessione SQL con privilegi"],"steps":["sqlcmd -S <server> -d <db> -Q \"ALTER SECURITY POLICY PORTAL.RLS_TENANT_POLICY_USERS WITH (STATE = ON);\""],"verify":["SELECT * FROM sys.security_policies WHERE name='RLS_TENANT_POLICY_USERS' mostra state ON"],"references":["db/flyway/sql/V5__rls_setup.sql"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-deploy-appservice-012","intent":"deploy-appservice","question":"Come deployo l'API su Azure App Service (dev)?","tags":["deploy","azure"],"preconditions":["az login","Resource Group e App Service esistenti o permessi di creazione"],"steps":["az webapp up -n <appName> -g <rg> -l westeurope --runtime \"NODE|20-lts\"","az webapp config appsettings set -g <rg> -n <appName> --settings AUTH_ISSUER=... AUTH_JWKS_URI=... AUTH_CLIENT_ID=... AUTH_TENANT_ID=... DB_CONN_STRING=... AZURE_STORAGE_CONNECTION_STRING=... BRANDING_CONTAINER=portal-assets BRANDING_PREFIX=config","az webapp restart -g <rg> -n <appName>"],"verify":["curl https://<appName>.azurewebsites.net/api/health -> 401 (auth richiesta)","/portal risponde"],"references":["EasyWay-DataPortal/easyway-portal-api/README.md"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-teams-check-013","intent":"teams-post-checklist","question":"Come invio l'esito Checklist su Teams?","tags":["teams","checklist"],"preconditions":["Teams Incoming Webhook URL"],"steps":["pwsh scripts/checklist.ps1 -JsonOnly","curl -H 'Content-Type: application/json' -d @EasyWay-DataPortal/easyway-portal-api/checklist.json <TEAMS_WEBHOOK_URL>"],"verify":["Messaggio ricevuto nel canale Teams"],"references":["scripts/checklist.ps1","azure-pipelines.yml"],"updated":"2025-10-19T00:00:00Z"}
