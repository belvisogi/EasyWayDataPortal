{
  "id": "agent_security",
  "name": "agent_security",
  "role": "Agent_Security",
  "description": "Elite Security Engineer: AI threat analysis, secrets governance, OWASP checks con Evaluator-Optimizer, parallel CVE scan e confidence-gated escalation. Level 3 agent.",
  "owner": "team-platform",
  "version": "3.0.0",
  "level": "L3",
  "classification": "arm",
  "evolution_level": 3,

  "llm_config": {
    "provider": "deepseek",
    "model": "deepseek-chat",
    "api_base": "https://api.deepseek.com",
    "temperature": 0.1,
    "max_tokens": 1500,
    "system_prompt": "agents/agent_security/PROMPTS.md",
    "tools": ["function_calling"],
    "cost_estimate": {
      "per_call": "$0.00035",
      "monthly": "$0.07"
    },
    "evaluator": true,
    "working_memory": true,
    "parallel_scan": true,
    "usage": {
      "security_analyze": "L3 threat assessment: Evaluator-Optimizer (AC-04/05/07), dual CVE scan, session, confidence gating",
      "security_owasp_check": "OWASP Top 10 evaluation con Evaluator-Optimizer",
      "kv_secret_set": "Set/update secret in Azure Key Vault (AC-08 naming check)",
      "kv_secret_reference": "Generate Key Vault reference for App Settings",
      "access_registry_propose": "Propose access registry entry (audit trail)"
    }
  },

  "context_config": {
    "memory_files": [
      "agents/agent_security/memory/context.json",
      "agents/kb/recipes.jsonl"
    ],
    "context_limit_tokens": 128000
  },

  "skills_required": [
    "retrieval.llm-with-rag",
    "retrieval.rag-search",
    "security.secret-vault",
    "security.cve-scan",
    "session.manage",
    "utilities.json-validate"
  ],

  "skills_optional": [
    "utilities.retry-backoff",
    "integration.slack-message"
  ],

  "rag_config": {
    "enabled": true,
    "collection": "easyway_wiki",
    "top_k": 5,
    "min_score": 0.3,
    "context_domains": ["security", "infrastructure", "deploy"],
    "description": "RAG provides Wiki context for AI-driven threat analysis and security assessments"
  },

  "evaluator_config": {
    "enabled_actions": ["security:analyze", "security:owasp-check"],
    "max_iterations": 2,
    "acceptance_criteria_ids": ["AC-04", "AC-05", "AC-07"],
    "confidence_threshold": 0.70,
    "graceful_degradation": true
  },

  "allowed_tools": ["pwsh", "az", "curl"],

  "actions": [
    {
      "name": "security:analyze",
      "description": "L3 AI-driven threat assessment. Evaluator-Optimizer su AC-04/05/07, dual CVE scan (docker-scout + trivy) se scan_target presente, working memory per audit multi-step, confidence < 0.70 => requires_human_review.",
      "uses_skills": ["retrieval.llm-with-rag", "retrieval.rag-search", "security.cve-scan", "session.manage"],
      "params": {
        "query":       { "type": "string", "required": true,  "description": "Contesto da analizzare" },
        "scan_target": { "type": "string", "required": false, "description": "Docker image name per CVE scan" }
      }
    },
    {
      "name": "security:owasp-check",
      "description": "OWASP Top 10 evaluation con Evaluator-Optimizer. Ritorna risk_level, confidence, findings.",
      "uses_skills": ["retrieval.llm-with-rag", "retrieval.rag-search"],
      "params": {
        "query": { "type": "string", "required": true, "description": "Endpoint o configurazione da verificare" }
      }
    },
    {
      "name": "kv-secret:set",
      "description": "Imposta/aggiorna un secret in Azure Key Vault. AC-08: naming convention <system>--<area>--<name> obbligatoria.",
      "uses_skills": ["security.secret-vault"],
      "params": {
        "vaultName":   { "type": "string", "required": true },
        "secretName":  { "type": "string", "required": true },
        "secretValue": { "type": "string", "required": true },
        "tags":        { "type": "object", "required": false }
      }
    },
    {
      "name": "kv-secret:reference",
      "description": "Genera una Key Vault reference per App Settings (non legge il valore).",
      "uses_skills": ["security.secret-vault"],
      "params": {
        "vaultName":  { "type": "string", "required": true },
        "secretName": { "type": "string", "required": true },
        "version":    { "type": "string", "required": false }
      }
    },
    {
      "name": "access-registry:propose",
      "description": "Propone una riga registry accessi (audit) senza valori segreti.",
      "uses_skills": [],
      "params": {
        "access": { "type": "object", "required": true }
      }
    }
  ],

  "allowed_paths": {
    "read": [
      "agents/agent_security/",
      "scripts/pwsh/agent-security.ps1",
      "Wiki/EasyWayData.wiki/security/",
      "Wiki/EasyWayData.wiki/control-plane/",
      "docs/agentic/templates/",
      "agents/kb/recipes.jsonl",
      "docs/agentic/templates/sheets/access-registry.csv"
    ],
    "write": [
      "agents/logs/",
      "agents/agent_security/memory/"
    ]
  },

  "required_gates": ["KB_Consistency"],

  "approvals": {
    "prod": ["Human_Governance_Approval"],
    "critical_risk": ["Human_Governance_Approval"]
  },

  "knowledge_sources": [
    { "priority": "high", "path": "Wiki/EasyWayData.wiki/security/segreti-e-accessi.md", "type": "document" },
    { "priority": "high", "path": "Wiki/EasyWayData.wiki/security/operativita-governance-provisioning-accessi.md", "type": "document" },
    { "priority": "medium", "path": "docs/ci/azure-devops-secrets.md", "type": "document" },
    { "priority": "medium", "path": "agents/kb/recipes.jsonl", "type": "data" }
  ],

  "error_handling": {
    "retry_count": 3,
    "retry_delay_seconds": 30,
    "fallback_mode": "skip_llm_analysis",
    "alert_on_failure": true
  },

  "readme": "README.md"
}
