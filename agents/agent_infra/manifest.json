{
  "id": "agent_infra",
  "name": "agent_infra",
  "role": "Agent_Infra",
  "description": "IaC/Terraform governance e infrastructure drift/compliance assessment. Level 3 agent con DeepSeek LLM, Evaluator-Optimizer, Working Memory e structured JSON output.",
  "owner": "team-platform",
  "version": "3.0.0",
  "level": "L2",
  "classification": "arm",
  "evolution_level": 3,
  "readme": "README.md",
  "runner": "agents/agent_infra/Invoke-AgentInfra.ps1",

  "llm_config": {
    "provider": "deepseek",
    "model": "deepseek-chat",
    "api_base": "https://api.deepseek.com",
    "temperature": 0.0,
    "max_tokens": 1500,
    "system_prompt": "agents/agent_infra/PROMPTS.md",
    "tools": ["function_calling"],
    "evaluator": true,
    "working_memory": true,
    "cost_estimate": {
      "per_call": "$0.00040",
      "monthly": "$0.08"
    },
    "usage": {
      "drift_check": "AI-driven drift assessment: structured JSON output con risk_level, confidence, findings[]",
      "compliance_check": "AI compliance check vs platform policies (porte, segreti, IaC patterns)"
    }
  },

  "context_config": {
    "memory_files": [
      "agents/agent_infra/memory/context.json",
      "agents/kb/recipes.jsonl"
    ],
    "context_limit_tokens": 128000,
    "enable_memory": true
  },

  "skills_required": [
    "retrieval.llm-with-rag",
    "retrieval.rag-search",
    "session.manage"
  ],

  "skills_optional": [
    "utilities.json-validate",
    "utilities.retry-backoff"
  ],

  "rag_config": {
    "enabled": true,
    "collection": "easyway_wiki",
    "top_k": 5,
    "min_score": 0.3,
    "context_domains": ["infrastructure", "terraform", "deploy", "dr", "security"],
    "description": "RAG provides Wiki context for AI-driven drift and compliance analysis"
  },

  "allowed_tools": ["pwsh", "terraform", "az"],

  "actions": [
    {
      "name": "infra:terraform-plan",
      "description": "Esegue terraform init/validate/plan (no apply). Scripted, WhatIf-by-default.",
      "evolution_level": 1,
      "uses_skills": [],
      "params": {
        "workdir": {
          "type": "string",
          "required": false,
          "description": "Directory Terraform (default: infra/terraform)"
        }
      }
    },
    {
      "name": "infra:drift-check",
      "description": "AI-driven drift assessment L3: analizza stato infra vs IaC tramite RAG+Evaluator. Output JSON strutturato: risk_level, confidence, findings[].",
      "evolution_level": 3,
      "uses_skills": ["retrieval.llm-with-rag", "session.manage"],
      "params": {
        "query": {
          "type": "string",
          "required": true,
          "description": "Contesto infra da analizzare (es. output terraform plan, stato container Docker)"
        }
      }
    },
    {
      "name": "infra:compliance-check",
      "description": "AI compliance check L3: verifica infra vs policy di piattaforma (porte, segreti, IaC patterns). Output JSON strutturato.",
      "evolution_level": 3,
      "uses_skills": ["retrieval.llm-with-rag", "session.manage"],
      "params": {
        "query": {
          "type": "string",
          "required": true,
          "description": "Stato infra da verificare vs policy (es. porte esposte, configurazione segreti)"
        }
      }
    }
  ],

  "allowed_paths": {
    "read": [
      "agents/agent_infra/**",
      "scripts/pwsh/agent-infra.ps1",
      "infra/terraform/**",
      "Wiki/EasyWayData.wiki/**",
      "agents/kb/recipes.jsonl",
      "agents/logs/**",
      "out/**"
    ],
    "write": [
      "agents/agent_infra/memory/",
      "agents/logs/"
    ]
  },

  "required_gates": ["KB_Consistency"],

  "approvals": {
    "apply": ["Human_Governance_Approval"],
    "drift_critical": ["Human_Governance_Approval"]
  },

  "knowledge_sources": [
    {
      "priority": "high",
      "type": "document",
      "path": "Wiki/EasyWayData.wiki/deploy-app-service.md"
    },
    {
      "priority": "high",
      "type": "document",
      "path": "Wiki/EasyWayData.wiki/dr-inventory-matrix.md"
    },
    {
      "priority": "medium",
      "type": "data",
      "path": "agents/kb/recipes.jsonl"
    }
  ],

  "error_handling": {
    "retry_count": 2,
    "retry_delay_seconds": 15,
    "fallback_mode": "log_and_skip",
    "alert_on_failure": false
  },

  "changelog": [
    {
      "version": "3.0.0",
      "date": "2026-02-19",
      "changes": "L3 promotion: Evaluator-Optimizer, Working Memory, structured JSON output, infra:compliance-check action"
    },
    {
      "version": "2.0.0",
      "date": "2026-02-19",
      "changes": "L2: DeepSeek LLM + RAG, infra:drift-check free-form output"
    },
    {
      "version": "1.0.0",
      "date": "2026-02-09",
      "changes": "L1: scripted only, infra:terraform-plan"
    }
  ]
}
