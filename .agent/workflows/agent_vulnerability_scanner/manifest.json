{
  "name": "agent_vulnerability_scanner",
  "version": "1.0.0",
  "type": "security_automation",
  "description": "Daily security scanner for CVEs, EOL dates, version compatibility, and certificate expiry",
  "author": "EasyWay DevOps Team",
  "created": "2026-02-07",

  "schedule": {
    "cron": "0 6 * * *",
    "timezone": "Europe/Rome",
    "description": "Daily at 6:00 AM"
  },

  "capabilities": [
    "docker_image_cve_scan",
    "eol_date_monitoring",
    "version_compatibility_check",
    "npm_audit",
    "python_safety_check",
    "certificate_expiry_monitoring",
    "dependency_graph_analysis"
  ],

  "integrations": {
    "n8n": {
      "workflow_id": "vulnerability_scanner_daily",
      "webhook_url": "/webhook/security-scan",
      "api_endpoint": "/api/v1/workflows/vulnerability-scanner"
    },
    "azure_keyvault": {
      "vault_name": "easyway-vault",
      "secrets_required": [
        "DOCKER_HUB_TOKEN",
        "GITHUB_TOKEN",
        "SNYK_API_KEY"
      ]
    },
    "notification_channels": {
      "critical": ["slack", "email", "pagerduty"],
      "high": ["slack", "email"],
      "medium": ["slack"],
      "low": ["wiki_report"]
    }
  },

  "data_sources": {
    "cve_databases": [
      "https://nvd.nist.gov/feeds/json/cve/1.1",
      "https://api.snyk.io/v1/test",
      "https://github.com/advisories"
    ],
    "eol_api": "https://endoflife.date/api",
    "compatibility_matrix": "./compatibility-matrix.json",
    "docker_hub_api": "https://hub.docker.com/v2/repositories"
  },

  "scan_targets": {
    "docker_images": [
      "n8nio/n8n",
      "qdrant/qdrant",
      "postgres",
      "traefik",
      "gitlab/gitlab-ce",
      "gitlab/gitlab-runner",
      "mcr.microsoft.com/azure-sql-edge",
      "bitnami/minio",
      "chromadb/chroma",
      "caddy",
      "nginx"
    ],
    "npm_projects": [
      "./apps/portal-frontend",
      "./portal-api",
      "./packages/dqf-agent"
    ],
    "python_projects": [
      "./agents"
    ],
    "certificates": [
      {
        "domain": "*.yourdomain.com",
        "alert_days_before": 14
      }
    ]
  },

  "compatibility_rules": {
    "n8n": {
      "requires": {
        "postgres": ">=13.0.0",
        "node": ">=18.0.0"
      },
      "compatible_with": {
        "qdrant": ">=1.8.0",
        "traefik": ">=2.0.0"
      }
    },
    "qdrant": {
      "api_version": "v1",
      "breaking_changes": {
        "v1.0.0": "API endpoints restructured",
        "v1.8.0": "Authentication required by default"
      }
    },
    "postgres": {
      "requires": {
        "docker_api": ">=1.40"
      }
    },
    "traefik": {
      "requires": {
        "docker_api": ">=1.44"
      },
      "known_issues": {
        "v3.0-v3.2": "Docker client 1.24 hardcoded - incompatible with Docker Engine >=29.0"
      }
    }
  },

  "severity_thresholds": {
    "critical": {
      "cvss_score": ">=9.0",
      "eol_days_remaining": "<=7",
      "certificate_expiry_days": "<=3",
      "action": "immediate_alert"
    },
    "high": {
      "cvss_score": ">=7.0",
      "eol_days_remaining": "<=30",
      "certificate_expiry_days": "<=14",
      "action": "alert_and_report"
    },
    "medium": {
      "cvss_score": ">=4.0",
      "eol_days_remaining": "<=90",
      "certificate_expiry_days": "<=30",
      "action": "daily_report"
    },
    "low": {
      "cvss_score": "<4.0",
      "eol_days_remaining": ">90",
      "certificate_expiry_days": ">30",
      "action": "weekly_summary"
    }
  },

  "output": {
    "wiki_report": "Wiki/EasyWayData.wiki/security/vulnerability-scan-{date}.md",
    "slack_channel": "#security-alerts",
    "email_recipients": ["devops@easyway.com"],
    "dashboard_url": "https://n8n.yourdomain.com/dashboard/security"
  },

  "permissions": {
    "docker": ["inspect", "version"],
    "ssh": ["server_access"],
    "filesystem": ["read_package_json", "read_requirements_txt"],
    "network": ["api_calls"],
    "keyvault": ["read_secrets"]
  },

  "error_handling": {
    "retry_count": 3,
    "retry_delay_seconds": 60,
    "fallback_mode": "use_cached_data",
    "alert_on_failure": true
  }
}
