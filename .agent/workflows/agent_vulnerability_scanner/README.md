# ðŸ›¡ï¸ Agent Vulnerability Scanner

**Version:** 1.0.0
**Status:** âœ… Production Ready
**Last Updated:** 2026-02-07

---

## ðŸ“‹ Overview

Agent Vulnerability Scanner Ã¨ un sistema di automazione per la sicurezza che esegue scansioni giornaliere per rilevare:

- ðŸ” **CVE Detection** - VulnerabilitÃ  note in Docker images
- ðŸ“… **EOL Monitoring** - Software che sta per raggiungere End-of-Life
- ðŸ”— **Version Compatibility** - IncompatibilitÃ  tra versioni di componenti
- ðŸ“¦ **Dependency Audit** - VulnerabilitÃ  in NPM/Python dependencies
- ðŸ” **Certificate Monitoring** - Scadenza certificati SSL/TLS

---

## ðŸš€ Quick Start

### Esecuzione Manuale

```powershell
# Full scan con output Markdown
./scripts/pwsh/agent-vulnerability-scanner.ps1 -Mode full -OutputFormat markdown

# Quick scan (solo compatibilitÃ )
./scripts/pwsh/agent-vulnerability-scanner.ps1 -Mode compatibility-only

# Dry run (no file output)
./scripts/pwsh/agent-vulnerability-scanner.ps1 -DryRun
```

### Esecuzione Automatica (N8N)

1. Import workflow da `.agent/workflows/agent_vulnerability_scanner/n8n-workflow.json`
2. Configure credentials (Docker Hub, GitHub, Snyk)
3. Enable schedule: `0 6 * * *` (daily at 6 AM)
4. Test workflow manually first

---

## ðŸ“‚ File Structure

```
.agent/workflows/agent_vulnerability_scanner/
â”œâ”€â”€ manifest.json                  # Agent configuration
â”œâ”€â”€ compatibility-matrix.json      # Version compatibility rules
â”œâ”€â”€ README.md                      # This file
â””â”€â”€ n8n-workflow.json             # N8N automation workflow

scripts/pwsh/
â””â”€â”€ agent-vulnerability-scanner.ps1  # PowerShell execution script

Wiki/EasyWayData.wiki/security/
â”œâ”€â”€ vulnerability-scan-YYYY-MM-DD.md    # Daily reports (markdown)
â””â”€â”€ vulnerability-scan-YYYY-MM-DD.json  # Raw data (json)
```

---

## ðŸ”— Version Compatibility Matrix

### Current Production Stack Compatibility

```
N8N 1.123.20
â”œâ”€âœ… PostgreSQL 15.10 (min: 13.0, recommended: 15.10)
â”œâ”€âœ… Qdrant 1.12.4 (min: 1.8.0, tested: 1.12.4)
â”œâ”€âš ï¸ Node 20.x (min: 18.0, recommended: 20.11)
â””â”€âŒ Traefik 2.10 (Docker API incompatibility)

Traefik 2.10
â””â”€âŒ Docker Engine 29.1.5
    â”œâ”€ Traefik embedded client: 1.24
    â”œâ”€ Docker Engine API: 1.52
    â””â”€ Minimum required: 1.44
    â†’ CRITICAL: All Traefik versions incompatible
```

### Migration Recommendations

**CRITICAL - Traefik Replacement:**
```
Current: traefik:v2.10 (BROKEN - Docker API 1.24)
  â†“
Option 1: caddy:2.8-alpine (RECOMMENDED â­)
  â€¢ Auto HTTPS with Let's Encrypt
  â€¢ Simple Caddyfile configuration
  â€¢ Native Docker compatibility
  â€¢ Effort: 4 hours

Option 2: nginx:1.25-alpine
  â€¢ Battle-tested, high performance
  â€¢ Manual configuration required
  â€¢ No Docker discovery
  â€¢ Effort: 6 hours

Option 3: traefik:v2.10 with File Provider
  â€¢ Keep Traefik but disable Docker discovery
  â€¢ Manual route configuration
  â€¢ No auto-discovery
  â€¢ Effort: 3 hours
```

---

## ðŸ“Š Example Output

### Console Output

```
ðŸ›¡ï¸  EasyWay Vulnerability Scanner
Mode: full | Output: markdown

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCAN START
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  EOL Status Check
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ðŸ” Checking EOL status for postgres...
  postgres: 587 days until EOL

ðŸ” Checking EOL status for traefik...
  traefik: -203 days until EOL  âš ï¸ ALREADY EOL

2ï¸âƒ£  Version Compatibility Check
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Current versions:
    n8n: 1.123.20
    postgres: 15.10
    qdrant: 1.12.4
    traefik: 2.10

  [CRITICAL] traefik â†’ docker_engine: Docker client 1.24 incompatible
    â†’ Migrate to Caddy or Nginx (see compatibility-matrix.json)

3ï¸âƒ£  NPM Dependency Audit
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  apps/portal-frontend: âœ… No vulnerabilities
  portal-api: âš ï¸ 2 vulnerabilities found

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCAN SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ”´ CRITICAL: 1
ðŸŸ¡ HIGH:     1
ðŸŸ  MEDIUM:   2
âšª LOW:      0

Total Issues: 4
```

### Markdown Report

Generated at: `Wiki/EasyWayData.wiki/security/vulnerability-scan-2026-02-07.md`

---

## âš™ï¸ Configuration

### Severity Thresholds

Defined in `manifest.json`:

```json
{
  "severity_thresholds": {
    "critical": {
      "cvss_score": ">=9.0",
      "eol_days_remaining": "<=7",
      "certificate_expiry_days": "<=3"
    },
    "high": {
      "cvss_score": ">=7.0",
      "eol_days_remaining": "<=30",
      "certificate_expiry_days": "<=14"
    }
  }
}
```

### Scan Targets

Add/remove scan targets in `manifest.json`:

```json
{
  "scan_targets": {
    "docker_images": [
      "n8nio/n8n",
      "qdrant/qdrant",
      "postgres",
      "caddy"  // Add new images here
    ]
  }
}
```

### Notification Channels

Configure in `manifest.json`:

```json
{
  "notification_channels": {
    "critical": ["slack", "email", "pagerduty"],
    "high": ["slack", "email"],
    "medium": ["slack"],
    "low": ["wiki_report"]
  }
}
```

---

## ðŸ”” Alerting

### Slack Integration

Notifications sent to `#security-alerts` channel:

```
ðŸ›¡ï¸ Daily Security Scan - 2026-02-07

ðŸ”´ 1 CRITICAL issue found:
  â€¢ traefik â†’ docker_engine: Docker API incompatibility
    â†’ Action: Migrate to Caddy (see Wiki)

ðŸŸ¡ 1 HIGH severity finding:
  â€¢ Traefik v2.10 reached EOL 203 days ago

ðŸ“Š Full Report: https://wiki/security/vulnerability-scan-2026-02-07.md
```

### Email Alerts

Sent to `devops@easyway.com` for CRITICAL/HIGH findings.

### PagerDuty

CRITICAL findings trigger PagerDuty incident for immediate response.

---

## ðŸ§ª Testing

### Unit Tests

```powershell
# Test compatibility check only
./scripts/pwsh/agent-vulnerability-scanner.ps1 `
  -Mode compatibility-only `
  -DryRun

# Test with local Docker (no SSH)
./scripts/pwsh/agent-vulnerability-scanner.ps1 `
  -ServerSSH "" `
  -DryRun
```

### Integration Test

```powershell
# Full scan with all checks
./scripts/pwsh/agent-vulnerability-scanner.ps1 `
  -Mode full `
  -OutputFormat json
```

---

## ðŸ“š Compatibility Matrix Updates

### Adding New Component

Edit `compatibility-matrix.json`:

```json
{
  "compatibility_rules": {
    "new_component": {
      "1.0.0": {
        "requires": {
          "dependency": {
            "min": "2.0.0",
            "recommended": "2.5.0",
            "reason": "Explain why this version is required"
          }
        },
        "compatible_with": {
          "other_component": {
            "min": "3.0.0",
            "tested": ["3.2.0", "3.1.5"]
          }
        }
      }
    }
  }
}
```

### Documenting Breaking Changes

```json
{
  "breaking_changes": {
    "from_1.0.x": [
      "API endpoint /old changed to /new",
      "Environment variable OLD_VAR renamed to NEW_VAR",
      "Database migration required"
    ]
  }
}
```

---

## ðŸ› Troubleshooting

### Issue: "SSH connection failed"

**Solution:**
```powershell
# Test SSH manually
ssh -i "C:\old\Virtual-machine\ssh-key-2026-01-25.key" ubuntu@80.225.86.168 "echo test"

# Check key permissions
icacls "C:\old\Virtual-machine\ssh-key-2026-01-25.key"
```

### Issue: "Docker Scout not available"

**Solution:**
Docker Scout is optional. Agent falls back to endoflife.date API.

To enable Docker Scout:
```bash
# On server
docker scout --version
# If not installed:
docker plugin install docker/scout
```

### Issue: "NPM audit timeout"

**Solution:**
Increase timeout in script or skip NPM audit:

```powershell
./scripts/pwsh/agent-vulnerability-scanner.ps1 -Mode compatibility-only
```

---

## ðŸ“ˆ Performance

- **Full scan:** ~5-10 minutes (depends on image count)
- **Quick scan:** ~30 seconds
- **Compatibility-only:** ~10 seconds

**Optimization tips:**
- Run full scan daily at low-traffic hours (6 AM)
- Use quick scan for pre-deployment checks
- Cache endoflife.date API responses (15 min TTL)

---

## ðŸ” Security Considerations

**Secrets Required:**
- SSH key for server access
- Docker Hub token (optional, for private registries)
- GitHub token (for GitHub Advisories)
- Snyk API key (optional, for enhanced CVE data)

**Storage:**
- Store in Azure Key Vault
- Never commit to git
- Use N8N credential system

**Network Access:**
- Requires outbound HTTPS to:
  - endoflife.date API
  - Docker Hub API
  - GitHub API
  - Snyk API

---

## ðŸš€ Future Enhancements

- [ ] **Auto-PR for dependency updates** (MEDIUM vulnerabilities)
- [ ] **Historical trend analysis** (vulnerability count over time)
- [ ] **SBOM generation** (Software Bill of Materials)
- [ ] **Custom CVE database** (internal vulnerability tracking)
- [ ] **Integration with Dependabot** (GitHub-native updates)
- [ ] **Grafana dashboard** (real-time security metrics)

---

## ðŸ“ž Support

**Issues:** Create issue with `security` tag
**Wiki:** [Q&A Security](../../Wiki/EasyWayData.wiki/Q-A-deployment-security-hardening.md)
**Contact:** devops@easyway.com

---

**Maintained by:** EasyWay DevOps Team
**License:** Internal Use Only
**Version:** 1.0.0
