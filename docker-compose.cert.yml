# docker-compose.cert.yml — Stack CERT (UAT)
# Uso: docker compose -p easyway-cert -f docker-compose.yml -f docker-compose.cert.yml up -d --build
# Branch: release/* → deploy su CERT

services:
  agent-runner:
    container_name: easyway-cert-runner
    environment:
      - EASYWAY_MODE=Cert
      - ENVIRONMENT=cert
    networks:
      - easyway-cert-net

  qdrant:
    container_name: easyway-cert-cortex
    ports: !reset []   # nessuna porta esposta all'host in CERT
    volumes:
      - qdrant-cert-data:/qdrant/storage
    networks:
      - easyway-cert-net

  sql-edge:
    container_name: easyway-cert-db
    ports:
      - "1434:1433"    # host 1434 → container 1433
    volumes:
      - sql-cert-data:/var/opt/mssql
    networks:
      - easyway-cert-net

  azurite:
    container_name: easyway-cert-storage
    ports:
      - "11000:10000"
      - "11001:10001"
      - "11002:10002"
    volumes:
      - azurite-cert-data:/data
    networks:
      - easyway-cert-net

  minio:
    container_name: easyway-cert-storage-s3
    ports: !reset []   # nessuna porta esposta — accessibile solo via rete interna
    volumes:
      - minio-cert-data:/data
    networks:
      - easyway-cert-net

  frontend:
    container_name: easyway-cert-portal
    ports:
      - "4000:8080"    # host 4000 → container 8080
    environment:
      - ENVIRONMENT=cert
    networks:
      - easyway-cert-net

  n8n:
    container_name: easyway-cert-orchestrator
    ports:
      - "5679:5678"    # host 5679 → container 5678
    volumes:
      - n8n-cert-data:/home/node/.n8n
    networks:
      - easyway-cert-net

networks:
  easyway-cert-net:
    driver: bridge

volumes:
  qdrant-cert-data:
  sql-cert-data:
  azurite-cert-data:
  minio-cert-data:
  n8n-cert-data:
