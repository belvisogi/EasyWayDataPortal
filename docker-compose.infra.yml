version: '3.9'

services:
  # üö¶ Reverse Proxy (Gateway)
  traefik:
    image: traefik:v3.0
    container_name: easyway-gateway
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - easyway-net
  # ‚ö° Vector Database (Memory Cortex)
  chromadb:
    image: chromadb/chroma:latest
    container_name: easyway-cortex
    ports:
      - "8000:8000"
    volumes:
      - chroma-data:/chroma/chroma
    networks:
      - easyway-net

  # üóÑÔ∏è Database (SQL Edge - ARM compatible)
  sql-edge:
    image: mcr.microsoft.com/azure-sql-edge:latest
    container_name: easyway-db
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_SA_PASSWORD=${SQL_PASSWORD:-EasyWayStrongPassword1!}
    ports:
      - "1433:1433"
    volumes:
      - sql-data:/var/opt/mssql
    networks:
      - easyway-net

  # ‚òÅÔ∏è Blob Storage Emulator
  azurite:
    image: mcr.microsoft.com/azure-storage/azurite
    container_name: easyway-storage
    ports:
      - "10000:10000"
      - "10001:10001"
      - "10002:10002"
    volumes:
      - azurite-data:/data
    networks:
      - easyway-net

  # üóÑÔ∏è Sovereign Storage (MinIO)
  minio:
    image: minio/minio:latest
    container_name: easyway-storage-s3
    command: server /data --console-address ":9001"
    environment:
      - MINIO_ROOT_USER=${MINIO_ROOT_USER:-easywayadmin}
      - MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD:-EasyWaySovereignKey!}
    ports:
      - "9000:9000" # API
      - "9001:9001" # Console
    volumes:
      - minio-data:/data
    networks:
      - easyway-net

networks:
  easyway-net:
    driver: bridge
    name: easyway-net

volumes:
  chroma-data:
  sql-data:
  azurite-data:
  minio-data:
