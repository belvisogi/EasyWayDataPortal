services:
  # üö¶ Reverse Proxy (Gateway)
  traefik:
    image: traefik:v3.2
    container_name: easyway-gateway
    restart: unless-stopped
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - easyway-net
  # ‚ö° Vector Database (Memory Cortex)
  chromadb:
    image: chromadb/chroma:0.6.3
    container_name: easyway-cortex
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      - chroma-data:/chroma/chroma
    networks:
      - easyway-net

  # üóÑÔ∏è Database (SQL Edge - ARM compatible)
  sql-edge:
    image: mcr.microsoft.com/azure-sql-edge:2.0.0
    container_name: easyway-db
    restart: unless-stopped
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_SA_PASSWORD=${SQL_SA_PASSWORD}
    ports:
      - "1433:1433"
    volumes:
      - sql-data:/var/opt/mssql
    networks:
      - easyway-net

  # ‚òÅÔ∏è Blob Storage Emulator
  azurite:
    image: mcr.microsoft.com/azure-storage/azurite
    container_name: easyway-storage
    restart: unless-stopped
    ports:
      - "10000:10000"
      - "10001:10001"
      - "10002:10002"
    volumes:
      - azurite-data:/data
    networks:
      - easyway-net

  # üß† Vector Database (Qdrant Memory)
  qdrant:
    image: qdrant/qdrant:v1.12.4
    container_name: easyway-memory
    restart: unless-stopped
    environment:
      - QDRANT__SERVICE__API_KEY=${QDRANT_API_KEY}
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant-data:/qdrant/storage
    networks:
      - easyway-net

  # üóÑÔ∏è Sovereign Storage (MinIO)
  minio:
    image: bitnami/minio:2026.1.15-debian-12-r0
    container_name: easyway-storage-s3
    restart: unless-stopped
    command: server /data --console-address ":9001"
    environment:
      - MINIO_ROOT_USER=${MINIO_ROOT_USER}
      - MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}
    ports:
      - "9000:9000" # API
      - "9001:9001" # Console
    volumes:
      - minio-data:/data
    networks:
      - easyway-net

networks:
  easyway-net:
    driver: bridge
    name: easyway-net

volumes:
  chroma-data:
  sql-data:
  azurite-data:
  minio-data:
  qdrant-data:
