{"id":"kb-starter-appsettings-026","intent":"apply-appsettings-starter","question":"Come applico lo starter JSON degli App Settings via Azure CLI e REST ARM?","tags":["deploy","appsettings","azure","cli","rest"],"preconditions":["az login","Permessi su Resource Group/WebApp"],"steps":["# Azure CLI (singole chiavi):","az webapp config appsettings set -g <RESOURCE_GROUP> -n <WEBAPP_NAME> --settings AUTH_ISSUER=https://login.microsoftonline.com/<TENANT_ID>/v2.0 AUTH_JWKS_URI=https://login.microsoftonline.com/<TENANT_ID>/discovery/v2.0/keys DEFAULT_TENANT_ID=tenant01 PORTAL_BASE_PATH=/portal","# Azure CLI (da file JSON key=value): creare appsettings.json con { \"name\":\"KEY\",\"value\":\"VAL\" } in array, quindi:","az webapp config appsettings set -g <RESOURCE_GROUP> -n <WEBAPP_NAME> --settings @appsettings.json","# REST ARM (via az rest):","az rest --method POST --uri https://management.azure.com/subscriptions/<SUB_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Web/sites/<WEBAPP_NAME>/config/appsettings?api-version=2022-03-01 --body '{"properties": {"AUTH_ISSUER": "https://login.microsoftonline.com/<TENANT_ID>/v2.0", "AUTH_JWKS_URI": "https://login.microsoftonline.com/<TENANT_ID>/discovery/v2.0/keys", "DEFAULT_TENANT_ID": "tenant01", "PORTAL_BASE_PATH": "/portal"}}'"],"verify":["In Azure Portal → Configuration compaiono le nuove chiavi","L'app usa i valori aggiornati (riavvio automatico o forzato)"],"references":["Wiki/EasyWayData.wiki/DEPLOY_APP_SERVICE.md","azure-pipelines.yml"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-generate-appsettings-027","intent":"generate-appsettings-from-env","question":"Come genero appsettings.json a partire da .env.local (per flusso agentico)?","tags":["deploy","appsettings","automation"],"steps":["pwsh scripts/generate-appsettings.ps1 -ApiPath EasyWay-DataPortal/easyway-portal-api -OutDir ./out","Verranno creati: out/appsettings.cli.json (per az CLI) e out/appsettings.task.json (per AzureAppServiceSettings@1)","Applicare con: az webapp config appsettings set --settings @out/appsettings.cli.json oppure usare il file task nella pipeline"],"verify":["File generati e applicati; App Service mostra le chiavi in Configuration"],"references":["scripts/generate-appsettings.ps1","Wiki/EasyWayData.wiki/DEPLOY_APP_SERVICE.md"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-sync-appsettings-guardrail-028","intent":"sync-appsettings-guardrail","question":"Come supero il guardrail per sincronizzare App Settings su main/prod?","tags":["deploy","governance","appsettings"],"steps":["In Azure DevOps → Run pipeline, impostare ENABLE_SYNC_APPSETTINGS=true","Se il branch è main o ENVIRONMENT=prod, impostare anche GOV_APPROVED=true (approvazione Governance)","Impostare AZURE_SERVICE_CONNECTION, WEBAPP_NAME, RESOURCE_GROUP, (opz.) WEBAPP_SLOT","Eseguire pipeline; il job 'Sync App Settings from .env.local' verrà eseguito in sicurezza"],"verify":["Il job di Sync viene eseguito solo con GOV_APPROVED=true su main/prod","App Service mostra le chiavi aggiornate"],"references":["azure-pipelines.yml","Wiki/EasyWayData.wiki/DEPLOY_APP_SERVICE.md"],"updated":"2025-10-19T00:00:00Z"}
{"id":"kb-activity-gov-approved-029","intent":"activity-gov-approved","question":"Come leggo gli eventi con approvazione Governance (govApproved=true) via API?","tags":["activity","audit","ams"],"steps":["# Bash + jq:","curl -s http://localhost:3000/api/docs/activity.json | jq '[ .[] | select(.govApproved=="true") ]'","# PowerShell:","(Invoke-RestMethod -Uri 'http://localhost:3000/api/docs/activity.json') | Where-Object { $_.govApproved -eq 'true' } | ConvertTo-Json -Depth 5"],"verify":["La risposta contiene solo eventi con govApproved=true (badge ✅ nel log)"],"references":["EasyWay-DataPortal/easyway-portal-api/src/routes/docs.ts","Wiki/EasyWayData.wiki/ACTIVITY_LOG.md"],"updated":"2025-10-19T00:00:00Z"}
